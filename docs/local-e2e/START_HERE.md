# 👋 欢迎使用 3kstory 本地 E2E 验证方案

## 🎯 你来这里的原因

你想验证 3kstory 从 **剧本→后端→视频任务→mp4 URL** 的完整链路。

✅ 现在可以做到了！而且：
- ✨ **无需 GPU**（使用本地 ffmpeg）
- 🔥 **快速反馈**（5 秒生成视频）
- 📱 **完全离线**（无需云 API）
- ⏱️ **5 分钟启动**（一键脚本）

---

## ⚡ 5 分钟快速开始

### 第 1 步：安装依赖（1 分钟）

```bash
brew install ffmpeg
```

### 第 2 步：启动服务（2 分钟）

```bash
cd /path/to/3kstory
bash start-local-e2e.sh
```

**保持此终端运行不关闭！** 你会看到：
```
✅ PostgreSQL 已就绪
✅ Redis 已就绪
✅ 后端服务已就绪
✅ 视频生成服务已就绪
```

### 第 3 步：运行测试（2 分钟）

**打开新终端**，运行：

```bash
bash e2e-test.sh
```

**等待完成**，你会看到：

```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
   ✅ 完整的端到端验证流程已成功完成！
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

最终视频 URL: http://localhost:8003/files/{video_id}.mp4
```

**💯 完成！** 在浏览器中打开 URL 预览视频。

---

## 📚 文档导航

### 👤 我是新手，想快速理解

1. **阅读**：[QUICKSTART.md](../../QUICKSTART.md) - 30 秒快速参考
2. **运行**：`bash start-local-e2e.sh && bash e2e-test.sh`
3. **完成**：查看生成的视频

⏱️ **耗时**：5 分钟

---

### 👨‍💻 我是开发者，想深入了解

1. **阅读**：[LOCAL_E2E_GUIDE.md](./LOCAL_E2E_GUIDE.md) - 完整详细指南
2. **查看**：[backend/README.md](../../backend/README.md) - API 和架构
3. **研究**：脚本源代码

⏱️ **耗时**：1-2 小时

---

### 🏗️ 我是架构师，想了解实现方案

1. **阅读**：[LOCAL_E2E_IMPLEMENTATION.md](./LOCAL_E2E_IMPLEMENTATION.md)
2. **深入**：[docs/02-技术架构.md](../02-%E6%8A%80%E6%9C%AF%E6%9E%B6%E6%9E%84.md)
3. **学习**：[docs/05-AI视频生成原理.md](../05-AI%E8%A7%86%E9%A2%91%E7%94%9F%E6%88%90%E5%8E%9F%E7%90%86.md)

⏱️ **耗时**：2-3 小时

---

### 🚀 我是运维，想快速部署

1. **参考**：[QUICKSTART.md](../../QUICKSTART.md) - 快速命令汇总
2. **查看**：[FILES_CHECKLIST.md](./FILES_CHECKLIST.md) - 故障排除
3. **实施**：部署脚本到你的环境

⏱️ **耗时**：30 分钟

---

## 📋 所有文档一览

| 文档 | 说明 | 适合人群 |
|------|------|---------|
| **QUICKSTART.md** | 30 秒快速参考卡片 | ⭐ 所有人（首先看这个） |
| **LOCAL_E2E_GUIDE.md** | 完整详细使用指南 | 开发者和架构师 |
| **LOCAL_E2E_IMPLEMENTATION.md** | 实现方案总结 | 想了解设计的人 |
| **FILES_CHECKLIST.md** | 文件清单和故障排除 | 运维和集成工程师 |
| **IMPLEMENTATION_COMPLETE.md** | 完成总结（本文件） | 项目经理 |
| **README.md** | 项目总览 | 所有人 |
| **backend/README.md** | 后端 API 文档 | 后端开发者 |

---

## 🔧 三个核心脚本

### 1. `start-local-e2e.sh` - 启动服务

一键启动所有服务：

```bash
bash start-local-e2e.sh
```

**做了什么**：
- ✅ 检查依赖（ffmpeg、Docker）
- ✅ 启动 PostgreSQL 和 Redis
- ✅ 启动后端 API 服务
- ✅ 启动视频生成服务
- ✅ 验证所有服务健康状态

**运行位置**：项目根目录

---

### 2. `e2e-test.sh` - 运行完整测试

执行完整的 8 步端到端验证：

```bash
bash e2e-test.sh
```

**验证内容**：
1. 服务健康检查
2. 用户注册
3. 用户登录
4. 项目创建
5. 场景生成
6. 视频生成请求
7. 等待完成
8. 验证视频文件

**运行位置**：项目根目录（新终端）

---

### 3. `quick-video-test.sh` - 快速视频测试

快速测试视频生成功能（跳过认证）：

```bash
bash quick-video-test.sh
```

**用途**：
- 快速验证视频生成
- 调试视频参数
- CI/CD 测试

**运行位置**：项目根目录（新终端）

---

## 🎯 验证的完整链路

```
┌─────────────────────────────────────────────────────────────┐
│                    用户 (Mac)                              │
└────────────────────────┬────────────────────────────────────┘
                         │ 运行 e2e-test.sh
                         ▼
┌─────────────────────────────────────────────────────────────┐
│                   E2E 测试脚本                             │
│  ✅ 步骤 1: 服务健康检查                                   │
│  ✅ 步骤 2: 用户注册 → test@example.com                    │
│  ✅ 步骤 3: 用户登录 → 获取 token                          │
│  ✅ 步骤 4: 创建项目 → project_id = 123                    │
│  ✅ 步骤 5: 生成场景 → scene_id = 456                      │
│  ✅ 步骤 6: 请求视频生成 → video_id = abc...               │
│  ✅ 步骤 7: 等待完成 → 轮询 120 秒                          │
│  ✅ 步骤 8: 验证视频 → HTTP 200 OK                         │
└────────────────────────┬────────────────────────────────────┘
                         │ HTTP API 调用
                         ▼
        ┌────────────────────────────────────────┐
        │     后端服务 (localhost:8080)         │
        │  - 用户认证                           │
        │  - 项目管理                           │
        │  - 场景生成                           │
        │  - 视频请求转发                       │
        └────────────────────────┬───────────────┘
                                 │ HTTP API 调用
                                 ▼
        ┌────────────────────────────────────────┐
        │   视频生成服务 (localhost:8003)       │
        │  - ffmpeg 生成黑底文字视频            │
        │  - 支持图片循环播放                   │
        │  - < 5 秒生成完成                     │
        │  - 保存到 .local/videos/              │
        └────────────────────────┬───────────────┘
                                 │ 文件存储
                                 ▼
                    ┌──────────────────────┐
                    │  .local/videos/      │
                    │  video_abc...mp4     │
                    └──────────────────────┘
```

---

## 🌟 核心特性

### ✨ 本地视频生成
- 使用 ffmpeg（开源工具）
- 支持纯文字和图片模式
- 分辨率：16:9 和 9:16
- 生成时间：< 5 秒
- **无需 GPU**！

### 🔄 完整 E2E 验证
- 从用户注册到视频输出
- 8 步验证流程
- 清晰的进度显示
- 详细的错误信息

### ⚡ 快速启动
- 一键脚本启动
- 自动依赖检查
- 自动服务验证
- 5 分钟完成

### 📚 详细文档
- 快速参考（5 分钟）
- 完整指南（1 小时）
- 实现方案（2 小时）
- API 文档

---

## 📊 性能指标

| 指标 | 值 |
|------|-----|
| 启动时间 | ~30 秒 |
| E2E 流程 | 3-5 分钟 |
| 视频生成 | < 5 秒 |
| CPU 占用 | 低 |
| GPU 需求 | ❌ 无 |
| 网络需求 | ❌ 无 |

---

## ❓ 快速FAQ

**Q: 需要什么前置条件？**
A: macOS + Docker + ffmpeg（脚本会帮你检查）

**Q: 如何启动？**
A: `bash start-local-e2e.sh && bash e2e-test.sh`

**Q: 生成的视频在哪里？**
A: `.local/videos/` 目录

**Q: 如何修改视频参数？**
A: 编辑 `e2e-test.sh` 中的 duration 和 aspect_ratio

**Q: 可以离线运行吗？**
A: 可以！完全不需要网络和 GPU

**Q: 如何快速测试视频功能？**
A: `bash quick-video-test.sh`

更多问题见 [FILES_CHECKLIST.md](./FILES_CHECKLIST.md)

---

## 🚀 现在就开始吧！

### 方式 1：最快（5 分钟）

```bash
brew install ffmpeg
bash start-local-e2e.sh  # 终端 1
bash e2e-test.sh         # 终端 2
```

### 方式 2：先读文档再开始（15 分钟）

1. 读 [QUICKSTART.md](../../QUICKSTART.md)
2. 然后按上述方式启动

### 方式 3：深入学习（1-2 小时）

1. 读 [LOCAL_E2E_GUIDE.md](./LOCAL_E2E_GUIDE.md)
2. 读 [backend/README.md](../../backend/README.md)
3. 研究脚本源代码
4. 修改参数进行自定义

---

## 🎓 学习路径

```
新手               开发者               架构师
  │                 │                   │
  ├─ QUICKSTART   ├─ QUICKSTART      ├─ IMPLEMENTATION
  │               ├─ LOCAL_E2E_GUIDE ├─ DOCS
  ├─ 运行脚本      ├─ 深入API文档     ├─ 深入架构
  │               ├─ 研究源代码       │
  └─ 5 分钟        └─ 1-2 小时        └─ 2-3 小时
```

---

## 📞 获得帮助

| 问题 | 查看 |
|------|------|
| 如何快速开始 | [QUICKSTART.md](../../QUICKSTART.md) |
| 详细的步骤 | [LOCAL_E2E_GUIDE.md](./LOCAL_E2E_GUIDE.md) |
| 故障排除 | [FILES_CHECKLIST.md](./FILES_CHECKLIST.md) |
| API 文档 | [backend/README.md](../../backend/README.md) |
| 系统架构 | [docs/02-技术架构.md](../02-%E6%8A%80%E6%9C%AF%E6%9E%B6%E6%9E%84.md) |

---

## ✅ 总结

**问题**：如何在 Mac 本地验证整个系统链路？
**答案**：已实现！无需 GPU，5 分钟启动，完整 E2E 验证

**包含**：
- ✅ 启动脚本
- ✅ 测试脚本
- ✅ 完整文档
- ✅ 快速参考
- ✅ 故障排除

**立即行动**：
```bash
bash start-local-e2e.sh && bash e2e-test.sh
```

**推荐阅读**：[QUICKSTART.md](../../QUICKSTART.md)

---

**祝你使用愉快！** 🎉

如有问题，查看相应文档或联系我。
