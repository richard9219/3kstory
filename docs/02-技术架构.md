# 3kstory 技术架构

## 整体架构

```
┌─────────────────────────────────────────────────────────────┐
│                    前端层 (React/Next.js)                     │
└─────────────────────────────────────────────────────────────┘
                              ↓ HTTPS
┌─────────────────────────────────────────────────────────────┐
│                   API Gateway (Go + Gin)                      │
└─────────────────────────────────────────────────────────────┘
           ↓                  ↓                  ↓
┌──────────────────┐  ┌──────────────────┐  ┌──────────────────┐
│   用户服务        │  │   短剧服务        │  │   AI 任务服务     │
└──────────────────┘  └──────────────────┘  └──────────────────┘
                              ↓
            ┌─────────────────────────────────────┐
            │        AI 引擎层 (微服务集群)          │
            ├─────────────────────────────────────┤
            │  1️⃣ 剧本生成服务 (Qwen2.5-7B)        │
            │  2️⃣ 图像生成服务 (SDXL/Flux)         │
            │  3️⃣ 视频生成服务 (CogVideoX/Mochi)   │
            │  4️⃣ 审核服务 (Qwen2-VL)              │
            └─────────────────────────────────────┘
                              ↓
        ┌──────────────┐  ┌──────────────┐  ┌──────────────┐
        │  PostgreSQL  │  │    Redis     │  │  阿里云 OSS   │
        │ • 用户数据    │  │ • 任务队列    │  │ • 图片/视频   │
        │ • 短剧数据    │  │ • 缓存        │  │ • 静态资源    │
        └──────────────┘  └──────────────┘  └──────────────┘
```

## 实现路线（4 阶段）

### Phase 0：快速验证（2 周）✅
- Go 后端框架
- 用户认证系统  
- 项目管理
- 使用通义千问 API
- Docker 部署

### Phase 1：自建文本模型（4 周）
- 部署 Qwen2.5-7B
- vLLM + FastAPI
- 从 API 迁移到自建

### Phase 2：接入视频生成（6 周）
- 部署 CogVideoX-2B
- 关键场景视频生成
- 其他场景图片 + Ken Burns 效果

### Phase 3：多模态审核 + 优化（持续）
- Qwen2-VL 内容审核
- 自动打标签
- 性能优化和缓存
